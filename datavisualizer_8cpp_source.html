<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>qSLDcalc: datavisualizer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>datavisualizer.cpp</h1>  </div>
</div>
<div class="contents">
<a href="datavisualizer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * src/datavisualizer.cpp</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2010-2011, Ingo Bressler (qsldcalc at ingobressler.net)</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (c) 2009 Technische Universit√§t Berlin, </span>
<a name="l00006"></a>00006 <span class="comment"> * Stranski-Laboratory for Physical und Theoretical Chemistry</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This file is part of qSLDcalc.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * qSLDcalc is free software: you can redistribute it and/or modify</span>
<a name="l00011"></a>00011 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00012"></a>00012 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00013"></a>00013 <span class="comment"> * (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * qSLDcalc is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00018"></a>00018 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment"> * along with qSLDcalc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;QScrollBar&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="mainwindow_8h.html">mainwindow.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classDataVisualizer.html#aa025e161e648dbe7e14e969d3fb16c5d">00028</a> <a class="code" href="classDataVisualizer.html#aa025e161e648dbe7e14e969d3fb16c5d" title="Constructor.">DataVisualizer::DataVisualizer</a>(<a class="code" href="classMainWindow.html" title="Main window GUI configuration and management.">MainWindow</a> * parent, <a class="code" href="classElementDatabase.html" title="Contains all chemical elements currently known by this program.">ElementDatabase</a>&amp; db)
<a name="l00029"></a>00029         : QWidget(parent, Qt::Window),
<a name="l00030"></a>00030           Ui::<a class="code" href="classDataVisualizer.html" title="Displays all known chemical elements in a two-dimensional viewport organized by one of their property...">DataVisualizer</a>(),
<a name="l00031"></a>00031           mDB(&amp;db),
<a name="l00032"></a>00032           mMainWindow(parent)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034         setupUi(<span class="keyword">this</span>);
<a name="l00035"></a>00035         connect(cbCharacteristic, SIGNAL(activated(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classDataVisualizer.html#a7f18683bbf5955b91718f0da3475a635" title="Displays and draws all chemical elements sorted by their property specified by index.">display</a>(<span class="keywordtype">int</span>)));
<a name="l00036"></a>00036         cbCharacteristic-&gt;setCurrentIndex(<a class="code" href="classDataVisualizer.html#acaa27882b140daeae43e7f8ee0b606db" title="Initially selected element characteristic to show.">initialSelection</a>);
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keywordtype">void</span>
<a name="l00040"></a><a class="code" href="datavisualizer_8cpp.html#abbbf91b227134af529ef5440e2512181">00040</a> <a class="code" href="datavisualizer_8cpp.html#abbbf91b227134af529ef5440e2512181">outputRect</a>(<span class="keyword">const</span> QString&amp; str, <span class="keyword">const</span> QRectF&amp; r) 
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042         std::cerr &lt;&lt; str.toStdString()
<a name="l00043"></a>00043                 &lt;&lt; <span class="stringliteral">&quot; pos: (&quot;</span> &lt;&lt; r.x() &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; r.y() &lt;&lt; <span class="stringliteral">&quot;) dim: (&quot;</span> 
<a name="l00044"></a>00044                 &lt;&lt; r.width() &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; r.height() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00052"></a><a class="code" href="classPreparePropertyVariantForSorting.html">00052</a> <span class="keyword">class </span><a class="code" href="classPreparePropertyVariantForSorting.html" title="Prepares PropertyVariant data for sorting before drawing to a graphics scene.">PreparePropertyVariantForSorting</a>: <span class="keyword">public</span> boost::static_visitor&lt;void&gt;
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054 <span class="keyword">public</span>:
<a name="l00055"></a><a class="code" href="classPreparePropertyVariantForSorting.html#a9738dd616eb425660bd45922a65d87ad">00055</a>         <span class="keywordtype">void</span> <a class="code" href="classPreparePropertyVariantForSorting.html#a9738dd616eb425660bd45922a65d87ad">operator()</a>(<span class="keywordtype">int</span>&amp; i)<span class="keyword"> const </span>{}
<a name="l00056"></a><a class="code" href="classPreparePropertyVariantForSorting.html#af9f917fe2f43606173682267c65b90cb">00056</a>         <span class="keywordtype">void</span> <a class="code" href="classPreparePropertyVariantForSorting.html#af9f917fe2f43606173682267c65b90cb">operator()</a>(std::string&amp; s)<span class="keyword"> const </span>{}
<a name="l00057"></a><a class="code" href="classPreparePropertyVariantForSorting.html#a8eb7958ae0ad7f2dd96f935dd0b26901">00057</a>         <span class="keywordtype">void</span> <a class="code" href="classPreparePropertyVariantForSorting.html#a8eb7958ae0ad7f2dd96f935dd0b26901">operator()</a>(<span class="keywordtype">double</span>&amp; d)<span class="keyword"> const </span>{}
<a name="l00060"></a><a class="code" href="classPreparePropertyVariantForSorting.html#a68e0bd7b81ced5e052c22b48811a5ad1">00060</a>         <span class="keywordtype">void</span> <a class="code" href="classPreparePropertyVariantForSorting.html#a68e0bd7b81ced5e052c22b48811a5ad1" title="Special care for std::complex.">operator()</a>(<a class="code" href="element_8h.html#a1c1b16cc02d518bbe753449171ab7033" title="Complex numbers in floating point representation.">complex</a>&amp; c)<span class="keyword"> const </span>{
<a name="l00061"></a>00061                 c = <a class="code" href="element_8h.html#a1c1b16cc02d518bbe753449171ab7033" title="Complex numbers in floating point representation.">complex</a>(c.real(), 0.0);
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063 };
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keywordtype">void</span> 
<a name="l00066"></a><a class="code" href="classDataVisualizer.html#a7f18683bbf5955b91718f0da3475a635">00066</a> <a class="code" href="classDataVisualizer.html#a7f18683bbf5955b91718f0da3475a635" title="Displays and draws all chemical elements sorted by their property specified by index.">DataVisualizer::display</a>(<span class="keywordtype">int</span> index)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068         <span class="keywordflow">if</span> (!<a class="code" href="classDataVisualizer.html#a2be29b2ed0ea407d54d163fe74d0a2d9" title="A link to the data base with all known chemical elements.">mDB</a> || !cbCharacteristic) <span class="keywordflow">return</span>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         <span class="keywordtype">int</span> propertyIndex(cbCharacteristic-&gt;itemData(index).toInt());
<a name="l00071"></a>00071         <span class="keywordflow">if</span> (propertyIndex &lt; 0 || propertyIndex &gt; <a class="code" href="classElement.html#ae04b3c2a9c0a436596611f89c4539edf" title="Returns the overall number of available properties.">Element::propertyCount</a>())
<a name="l00072"></a>00072                 <span class="keywordflow">return</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment">// see if item should be drawn</span>
<a name="l00075"></a>00075         <a class="code" href="classElement.html#af1fef5f2cf831ab74263327747a53099" title="All properties of an Element in the database.">Element::Property</a> p(<a class="code" href="classElement.html#a480004eb27430763618c4a9986a51ada" title="Returns the Property with the specified index.">Element::getProperty</a>(propertyIndex));
<a name="l00076"></a>00076         <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6b" title="The data type of a property to allow for convenient testing at runtime.">Element::PropertyType</a> type(<a class="code" href="classElement.html#ac896ed2536b7c08d22e827d1ec187023" title="Returns the data type of a given property.">Element::propertyType</a>(p));
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (type == <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6ba38616d467a30862553871bd4251666da" title="Complex number with floating point.">Element::COMPLEX_TYPE</a> ||
<a name="l00079"></a>00079             type == <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6ba25c9def31c96d25597e9f1a0895483a7" title="Character string.">Element::STRING_TYPE</a>) {
<a name="l00080"></a>00080                 lblPlotType-&gt;setText(tr(<span class="stringliteral">&quot;[ Horizontal distances are &lt;b&gt;not&lt;/b&gt; proportional to the values. ]&quot;</span>));
<a name="l00081"></a>00081         } <span class="keywordflow">else</span> {
<a name="l00082"></a>00082                 lblPlotType-&gt;setText(tr(<span class="stringliteral">&quot;[ Horizontal distances are proportional to the values. ]&quot;</span>));
<a name="l00083"></a>00083         }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="comment">// reset graphics scene</span>
<a name="l00086"></a>00086         <a class="code" href="classDataVisualizer.html#a9c5112e48e7120cbc4a1477bff5954d0" title="Shortcut.">SceneType</a> scene(<span class="keyword">new</span> QGraphicsScene());
<a name="l00087"></a>00087         <a class="code" href="classDataVisualizer.html#a9c5112e48e7120cbc4a1477bff5954d0" title="Shortcut.">SceneType</a> oldScene(gvDisplay-&gt;scene());
<a name="l00088"></a>00088         gvDisplay-&gt;setScene(scene);
<a name="l00089"></a>00089         <span class="keywordflow">if</span> (oldScene) <span class="keyword">delete</span> oldScene;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <a class="code" href="classElementDatabase.html#ac1c644fb4c99dc3d3741b1703a305e60" title="An iterator over the whole element database.">ElementDatabase::Iterator</a> begin = <a class="code" href="classDataVisualizer.html#a2be29b2ed0ea407d54d163fe74d0a2d9" title="A link to the data base with all known chemical elements.">mDB</a>-&gt;begin();
<a name="l00092"></a>00092         <a class="code" href="classElementDatabase.html#ac1c644fb4c99dc3d3741b1703a305e60" title="An iterator over the whole element database.">ElementDatabase::Iterator</a> end = <a class="code" href="classDataVisualizer.html#a2be29b2ed0ea407d54d163fe74d0a2d9" title="A link to the data base with all known chemical elements.">mDB</a>-&gt;end();
<a name="l00093"></a>00093         <a class="code" href="classElementDatabase.html#ac1c644fb4c99dc3d3741b1703a305e60" title="An iterator over the whole element database.">ElementDatabase::Iterator</a> it = begin;
<a name="l00094"></a>00094         <span class="comment">// copy elements to sorted container first</span>
<a name="l00095"></a>00095         <span class="keyword">typedef</span> QMultiMap&lt;Element::PropertyVariant, Element::Ptr&gt; ElementMap;
<a name="l00096"></a>00096         ElementMap elemMap;
<a name="l00097"></a>00097         <span class="keywordflow">for</span>(; it != end; it++) 
<a name="l00098"></a>00098         {
<a name="l00099"></a>00099                 <a class="code" href="classElement.html#a983ee14456c5ca2ee3d11c8598a63ab1" title="A guarded Pointer to such an Element.">Element::Ptr</a> elem(it.value());
<a name="l00100"></a>00100                 <span class="keywordflow">if</span> (elem.isNull()) <span class="keywordflow">continue</span>;
<a name="l00101"></a>00101                 <a class="code" href="classElement.html#a8e8686e4f152188d462ed9585d88725e" title="Data type of a single property value.">Element::PropertyVariant</a> prop = elem-&gt;propertyConst(p);
<a name="l00102"></a>00102                 boost::apply_visitor(<a class="code" href="classPreparePropertyVariantForSorting.html" title="Prepares PropertyVariant data for sorting before drawing to a graphics scene.">PreparePropertyVariantForSorting</a>(), prop);
<a name="l00103"></a>00103                 elemMap.insert(prop, elem);
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="comment">// finally draw the elements</span>
<a name="l00107"></a>00107         qreal lastXPos = -1e10; <span class="comment">// need an arbitrary small number</span>
<a name="l00108"></a>00108         ElementMap::const_iterator mapIter = elemMap.begin();
<a name="l00109"></a>00109         <span class="keywordflow">for</span>(; mapIter != elemMap.end(); mapIter++) 
<a name="l00110"></a>00110         {
<a name="l00111"></a>00111                 <a class="code" href="classDataVisualizer.html#af64d43d58db2ed9ec6bdc3af26424267" title="Draws the selected property of an element to the scene in a way that it doesn&amp;#39;t overlap with othe...">draw</a>(scene, lastXPos, mapIter.value(), propertyIndex);
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113         <span class="comment">// get scene bounding box, add a margin</span>
<a name="l00114"></a>00114         QRectF sceneBoundingBox(scene-&gt;itemsBoundingRect());
<a name="l00115"></a>00115         sceneBoundingBox.setWidth(sceneBoundingBox.width()+2*<a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>);
<a name="l00116"></a>00116         sceneBoundingBox.setHeight(sceneBoundingBox.height()+2*<a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>);
<a name="l00117"></a>00117         sceneBoundingBox.translate(-1.0*<a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>, -1.0*<a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>);
<a name="l00118"></a>00118         scene-&gt;setSceneRect(sceneBoundingBox);
<a name="l00119"></a>00119         gvDisplay-&gt;show();
<a name="l00120"></a>00120         <a class="code" href="classDataVisualizer.html#a0431b878d602379ab52f5a9e72f1db78" title="Adjusts the height of the data visualization window to show as much data elements as possible...">adjustSize</a>();
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00127"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html">00127</a> <span class="keyword">class </span><a class="code" href="classDrawingPositionFromPropertyVariant.html" title="Calculates the position of this data element (variant data type) within the graphics scene...">DrawingPositionFromPropertyVariant</a>: <span class="keyword">public</span> boost::static_visitor&lt;QPointF&gt;
<a name="l00128"></a>00128 {
<a name="l00129"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">00129</a>         <span class="keyword">static</span> <span class="keyword">const</span> qreal <a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">mScale</a> = 50.0;
<a name="l00130"></a>00130 <span class="keyword">public</span>:
<a name="l00131"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html#a4089a8b914d41c4907bf53ace8d0da19">00131</a>         QPointF <a class="code" href="classDrawingPositionFromPropertyVariant.html#a4089a8b914d41c4907bf53ace8d0da19">operator()</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; i)<span class="keyword"> const </span>{
<a name="l00132"></a>00132                 <span class="keywordflow">return</span> QPointF(qreal(i)*<a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">mScale</a>, 0.0);
<a name="l00133"></a>00133         }
<a name="l00134"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html#a0c0ff1347aaf8208cb02192f9108b76c">00134</a>         QPointF <a class="code" href="classDrawingPositionFromPropertyVariant.html#a0c0ff1347aaf8208cb02192f9108b76c">operator()</a>(<span class="keyword">const</span> std::string&amp; s)<span class="keyword"> const </span>{
<a name="l00135"></a>00135                 <span class="keywordflow">return</span> QPointF(0.0, 0.0);
<a name="l00136"></a>00136                 <span class="comment">// using the operator for (const int&amp;)</span>
<a name="l00137"></a>00137 <span class="comment">//              return operator()(QString::fromStdString(s).toLower().at(0).toAscii()-(&#39;a&#39;));</span>
<a name="l00138"></a>00138         }
<a name="l00139"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html#a9914ee8f00a562ad19470a5669ddef01">00139</a>         QPointF <a class="code" href="classDrawingPositionFromPropertyVariant.html#a9914ee8f00a562ad19470a5669ddef01">operator()</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; d)<span class="keyword"> const </span>{
<a name="l00140"></a>00140                 <span class="keywordflow">return</span> QPointF(qreal(d)*<a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">mScale</a>, 0.0);
<a name="l00141"></a>00141         }
<a name="l00142"></a><a class="code" href="classDrawingPositionFromPropertyVariant.html#a5f00f34073edfdd04385c8f827e41ef5">00142</a>         QPointF <a class="code" href="classDrawingPositionFromPropertyVariant.html#a5f00f34073edfdd04385c8f827e41ef5">operator()</a>(<span class="keyword">const</span> <a class="code" href="element_8h.html#a1c1b16cc02d518bbe753449171ab7033" title="Complex numbers in floating point representation.">complex</a>&amp; c)<span class="keyword"> const </span>{
<a name="l00143"></a>00143                 <span class="keywordflow">return</span> QPointF(qreal(c.real())*<a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">mScale</a>, 
<a name="l00144"></a>00144                                qreal(c.imag())*<a class="code" href="classDrawingPositionFromPropertyVariant.html#acbca7ede1208bb5262837b36ec164458">mScale</a>*-1.0);
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146 };
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="keywordtype">void</span> 
<a name="l00149"></a><a class="code" href="classDataVisualizer.html#af64d43d58db2ed9ec6bdc3af26424267">00149</a> <a class="code" href="classDataVisualizer.html#af64d43d58db2ed9ec6bdc3af26424267" title="Draws the selected property of an element to the scene in a way that it doesn&amp;#39;t overlap with othe...">DataVisualizer::draw</a>(<a class="code" href="classDataVisualizer.html#a9c5112e48e7120cbc4a1477bff5954d0" title="Shortcut.">SceneType</a> scene, qreal&amp; lastXPos, <a class="code" href="classElement.html#a983ee14456c5ca2ee3d11c8598a63ab1" title="A guarded Pointer to such an Element.">Element::Ptr</a> e, <span class="keywordtype">int</span> propertyIndex)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151         <span class="keywordflow">if</span> (e.isNull()) <span class="keywordflow">return</span>;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="comment">// see if item should be drawn</span>
<a name="l00154"></a>00154         <a class="code" href="classElement.html#af1fef5f2cf831ab74263327747a53099" title="All properties of an Element in the database.">Element::Property</a> p(<a class="code" href="classElement.html#a480004eb27430763618c4a9986a51ada" title="Returns the Property with the specified index.">Element::getProperty</a>(propertyIndex));
<a name="l00155"></a>00155         <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6b" title="The data type of a property to allow for convenient testing at runtime.">Element::PropertyType</a> type(<a class="code" href="classElement.html#ac896ed2536b7c08d22e827d1ec187023" title="Returns the data type of a given property.">Element::propertyType</a>(p));
<a name="l00156"></a>00156         <a class="code" href="classElement.html#a8e8686e4f152188d462ed9585d88725e" title="Data type of a single property value.">Element::PropertyVariant</a> var(e-&gt;propertyConst(p));
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (p == <a class="code" href="classElement.html#af1fef5f2cf831ab74263327747a53099a798ab51800c2b1c8ad514133cf1a74ec" title="Number of nucleons (aka atomic mass number A).">Element::NUCLEONS_PROPERTY</a> &amp;&amp; !e-&gt;isIsotope()) <span class="keywordflow">return</span>;
<a name="l00159"></a>00159         <span class="keywordflow">if</span> (!<a class="code" href="classElement.html#af35d80cb6273da513b1d2595b9482249" title="Tests a given property value for invalid type.">Element::isValidVariant</a>(var)) <span class="keywordflow">return</span>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         <span class="comment">// build the text item</span>
<a name="l00162"></a>00162         QGraphicsItem * item(0);
<a name="l00163"></a>00163         QGraphicsTextItem * text = <span class="keyword">new</span> QGraphicsTextItem();
<a name="l00164"></a>00164         text-&gt;setHtml( <a class="code" href="classDataVisualizer.html#af78d96091bb256e9f520f0d53c326d08" title="Generate a link text for the specified element to display detailed element data in the mainwindow...">getLinkText</a>(*e) + <span class="stringliteral">&quot;&lt;br&gt;&quot;</span> +
<a name="l00165"></a>00165                 <a class="code" href="classDataVisualizer.html#a119c2a033ba5ecd7398841550e9ae6ad" title="The parent window.">mMainWindow</a>-&gt;<a class="code" href="classMainWindow.html#a3ce925cd8de46e42c230aa3bf934c38d" title="Converts any property of a chemical element to a localization aware character string.">toString</a>(var));
<a name="l00166"></a>00166         text-&gt;setTextInteractionFlags(Qt::TextBrowserInteraction);
<a name="l00167"></a>00167         text-&gt;setToolTip(tr(<span class="stringliteral">&quot;formattedFormulaToolTip&quot;</span>));
<a name="l00168"></a>00168         connect(text, SIGNAL(linkActivated(<span class="keyword">const</span> QString&amp;)), 
<a name="l00169"></a>00169                 <span class="keyword">this</span>, SLOT(<a class="code" href="classDataVisualizer.html#a8773a0e5ff63971d202a97537b759639" title="Signal forwarder to display element details in the mainwindow.">emitElementLinkActivated</a>(<span class="keyword">const</span> QString&amp;)));
<a name="l00170"></a>00170         item = text;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="comment">// build the encapsulating box item</span>
<a name="l00173"></a>00173         QGraphicsRectItem * rect = <span class="keyword">new</span> QGraphicsRectItem(
<a name="l00174"></a>00174                 item-&gt;boundingRect() );
<a name="l00175"></a>00175         rect-&gt;setBrush(QBrush(QColor(196, 255, 196)));
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="comment">// combine both and add them to the scene</span>
<a name="l00178"></a>00178         item-&gt;setParentItem(rect);
<a name="l00179"></a>00179         scene-&gt;addItem(rect);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         QPointF pos(boost::apply_visitor(<a class="code" href="classDrawingPositionFromPropertyVariant.html" title="Calculates the position of this data element (variant data type) within the graphics scene...">DrawingPositionFromPropertyVariant</a>(), var));
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (type == <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6ba38616d467a30862553871bd4251666da" title="Complex number with floating point.">Element::COMPLEX_TYPE</a> ||
<a name="l00183"></a>00183             type == <a class="code" href="classElement.html#afd29791e52655644df6a09bedf336c6ba25c9def31c96d25597e9f1a0895483a7" title="Character string.">Element::STRING_TYPE</a>) {
<a name="l00184"></a>00184                 <span class="comment">// no stacking for 2D drawing</span>
<a name="l00185"></a>00185                 <span class="comment">// item positions are stretched in X direction</span>
<a name="l00186"></a>00186                 <span class="keywordflow">if</span> (lastXPos &gt; pos.x()) {
<a name="l00187"></a>00187                         pos.setX(lastXPos);
<a name="l00188"></a>00188                 }
<a name="l00189"></a>00189                 rect-&gt;setPos(pos);
<a name="l00190"></a>00190                 <span class="comment">// update drawing position for the next item</span>
<a name="l00191"></a>00191                 lastXPos = pos.x() + rect-&gt;boundingRect().width() + <a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>;
<a name="l00192"></a>00192         } <span class="keywordflow">else</span> {
<a name="l00193"></a>00193                 <a class="code" href="classDataVisualizer.html#ace8d17e7820d66dabc4e3832e48707d8" title="Sets the position of an item in a graphics scene in a way it doesn&amp;#39;t collide or overlap with othe...">setItemPos</a>(rect, pos);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="keywordtype">void</span> 
<a name="l00198"></a><a class="code" href="classDataVisualizer.html#a0431b878d602379ab52f5a9e72f1db78">00198</a> <a class="code" href="classDataVisualizer.html#a0431b878d602379ab52f5a9e72f1db78" title="Adjusts the height of the data visualization window to show as much data elements as possible...">DataVisualizer::adjustSize</a>(<span class="keywordtype">void</span>)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200         <span class="comment">// determine the current difference between window size and viewport size</span>
<a name="l00201"></a>00201         <span class="keywordtype">int</span> margin = size().height() - gvDisplay-&gt;viewport()-&gt;size().height();
<a name="l00202"></a>00202         <span class="keywordtype">int</span> scrollBarWidth = 0;
<a name="l00203"></a>00203         <span class="comment">// get scrollbar height offset</span>
<a name="l00204"></a>00204         QScrollBar * vscroll = gvDisplay-&gt;horizontalScrollBar();
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (vscroll) scrollBarWidth = vscroll-&gt;sizeHint().height();
<a name="l00206"></a>00206         margin += scrollBarWidth;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         QSize newSize(size());
<a name="l00209"></a>00209         <span class="comment">// update height only</span>
<a name="l00210"></a>00210         newSize.setHeight(<span class="keywordtype">int</span>(gvDisplay-&gt;sceneRect().height()) + margin);
<a name="l00211"></a>00211         <span class="comment">// resize nescessary ?</span>
<a name="l00212"></a>00212         <span class="keywordflow">if</span> (size().height() != newSize.height()) {
<a name="l00213"></a>00213                 resize(newSize);
<a name="l00214"></a>00214         }
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="keywordtype">void</span> 
<a name="l00218"></a><a class="code" href="classDataVisualizer.html#ace8d17e7820d66dabc4e3832e48707d8">00218</a> <a class="code" href="classDataVisualizer.html#ace8d17e7820d66dabc4e3832e48707d8" title="Sets the position of an item in a graphics scene in a way it doesn&amp;#39;t collide or overlap with othe...">DataVisualizer::setItemPos</a>(QGraphicsItem * item, QPointF pos)
<a name="l00219"></a>00219 {
<a name="l00220"></a>00220         <span class="keyword">typedef</span> QList&lt;QGraphicsItem *&gt; QGraphicsItemList;
<a name="l00221"></a>00221         <a class="code" href="classDataVisualizer.html#a9c5112e48e7120cbc4a1477bff5954d0" title="Shortcut.">SceneType</a> scene(gvDisplay-&gt;scene());
<a name="l00222"></a>00222         <span class="keywordflow">if</span> (!item || !scene) <span class="keywordflow">return</span>;
<a name="l00223"></a>00223         <span class="comment">// set the desired position</span>
<a name="l00224"></a>00224         item-&gt;setPos(pos);
<a name="l00225"></a>00225         <span class="comment">// check for collisions with other items</span>
<a name="l00226"></a>00226         QList&lt;QGraphicsItem *&gt; collides = scene-&gt;collidingItems(item);
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (collides.size() == 0) <span class="keywordflow">return</span>;
<a name="l00228"></a>00228         QGraphicsItem * cItem = 0;
<a name="l00229"></a>00229         QGraphicsItemList::const_iterator it = collides.constBegin();
<a name="l00230"></a>00230         <span class="keywordflow">while</span>(it != collides.constEnd()) {
<a name="l00231"></a>00231                 cItem = *it;
<a name="l00232"></a>00232                 <span class="keywordflow">if</span> (cItem &amp;&amp; !cItem-&gt;parentItem()) <span class="keywordflow">break</span>;
<a name="l00233"></a>00233                 it++;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <span class="keywordflow">if</span> (!cItem || cItem-&gt;parentItem()) <span class="keywordflow">return</span>;
<a name="l00236"></a>00236         <span class="comment">// item has no parent =&gt; top-level, bounding rect</span>
<a name="l00237"></a>00237         qreal newYPos = cItem-&gt;y() + 
<a name="l00238"></a>00238                         0.5*cItem-&gt;boundingRect().height() + 
<a name="l00239"></a>00239                         0.5*item-&gt;boundingRect().height() +
<a name="l00240"></a>00240                         <a class="code" href="classDataVisualizer.html#ada4752493623baf287c148d004101222" title="Margin around items to not contact each other or the graphics view boundary.">itemMargin</a>;
<a name="l00241"></a>00241         QPointF newPos(pos);
<a name="l00242"></a>00242         newPos.setY(newYPos);
<a name="l00243"></a>00243         <a class="code" href="classDataVisualizer.html#ace8d17e7820d66dabc4e3832e48707d8" title="Sets the position of an item in a graphics scene in a way it doesn&amp;#39;t collide or overlap with othe...">setItemPos</a>(item, newPos);
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="keywordtype">void</span> 
<a name="l00247"></a><a class="code" href="classDataVisualizer.html#ae87bb6ec5bf5631d21d292bc128baaf9">00247</a> <a class="code" href="classDataVisualizer.html#ae87bb6ec5bf5631d21d292bc128baaf9" title="Shows this data visualization window to the user and selects the first property to display initially...">DataVisualizer::show</a>()
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249         <a class="code" href="classDataVisualizer.html#ae87bb6ec5bf5631d21d292bc128baaf9" title="Shows this data visualization window to the user and selects the first property to display initially...">QWidget::show</a>();
<a name="l00250"></a>00250         <a class="code" href="classDataVisualizer.html#aa336a8fcd92c31c815c8de0897e8a43f" title="Selects another Element characteristic and rebuilds the graphics scene.">selectIndex</a>(<a class="code" href="classDataVisualizer.html#acaa27882b140daeae43e7f8ee0b606db" title="Initially selected element characteristic to show.">initialSelection</a>);
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="keywordtype">void</span> 
<a name="l00254"></a><a class="code" href="classDataVisualizer.html#aa336a8fcd92c31c815c8de0897e8a43f">00254</a> <a class="code" href="classDataVisualizer.html#aa336a8fcd92c31c815c8de0897e8a43f" title="Selects another Element characteristic and rebuilds the graphics scene.">DataVisualizer::selectIndex</a>(<span class="keywordtype">int</span> index)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256         cbCharacteristic-&gt;setCurrentIndex(index);
<a name="l00257"></a>00257         <a class="code" href="classDataVisualizer.html#a7f18683bbf5955b91718f0da3475a635" title="Displays and draws all chemical elements sorted by their property specified by index.">display</a>(index);
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="keywordtype">void</span> 
<a name="l00261"></a><a class="code" href="classDataVisualizer.html#a8773a0e5ff63971d202a97537b759639">00261</a> <a class="code" href="classDataVisualizer.html#a8773a0e5ff63971d202a97537b759639" title="Signal forwarder to display element details in the mainwindow.">DataVisualizer::emitElementLinkActivated</a>(<span class="keyword">const</span> QString&amp; link)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263         emit <a class="code" href="classDataVisualizer.html#ac750675c1ed5e55ed2bd2254f8472d39" title="Emits a link text of the element whose detailed information should be shown in the main window and wh...">elementLinkActivated</a>(link);
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 QString 
<a name="l00267"></a><a class="code" href="classDataVisualizer.html#af78d96091bb256e9f520f0d53c326d08">00267</a> <a class="code" href="classDataVisualizer.html#af78d96091bb256e9f520f0d53c326d08" title="Generate a link text for the specified element to display detailed element data in the mainwindow...">DataVisualizer::getLinkText</a>(<span class="keyword">const</span> cfp::ChemicalElementInterface&amp; e)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269         QString s;
<a name="l00270"></a>00270         s.append(<span class="stringliteral">&quot;&lt;style&gt;a{text-decoration:none;}&lt;/style&gt;&lt;a href=\&quot;&quot;</span>);
<a name="l00271"></a>00271         s.append(<a class="code" href="classElementDatabase.html#a684d99c09bb653545e664802e56aeef8" title="Generates a key based on the given chemical element signature for retrieval of database elements...">ElementDatabase::makeKey</a>(e));
<a name="l00272"></a>00272         s.append(<span class="stringliteral">&quot;\&quot;&gt;&quot;</span>);
<a name="l00273"></a>00273         s.append(e.toMarkup().c_str());
<a name="l00274"></a>00274         s.append(<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>);
<a name="l00275"></a>00275         <span class="keywordflow">return</span> s;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="keywordtype">void</span> 
<a name="l00279"></a><a class="code" href="classDataVisualizer.html#a2af138cbb052f75ce31716509729fbb4">00279</a> <a class="code" href="classDataVisualizer.html#a2af138cbb052f75ce31716509729fbb4" title="Retranslates this subwindow at runtime.">DataVisualizer::retranslateUi</a>()
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281         <a class="code" href="classDataVisualizer.html#a2af138cbb052f75ce31716509729fbb4" title="Retranslates this subwindow at runtime.">Ui::DataVisualizer::retranslateUi</a>(<span class="keyword">this</span>);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="keywordtype">int</span> selectedIndex = cbCharacteristic-&gt;currentIndex();
<a name="l00284"></a>00284         <span class="comment">// remove all characteristics items first, add the retranslated again</span>
<a name="l00285"></a>00285         cbCharacteristic-&gt;clear();
<a name="l00286"></a>00286         <span class="keywordtype">int</span> count = <a class="code" href="classElement.html#ae04b3c2a9c0a436596611f89c4539edf" title="Returns the overall number of available properties.">Element::propertyCount</a>()-1;
<a name="l00287"></a>00287         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; count; i++)
<a name="l00288"></a>00288         {
<a name="l00289"></a>00289                 cbCharacteristic-&gt;insertItem(
<a name="l00290"></a>00290                         cbCharacteristic-&gt;count(), 
<a name="l00291"></a>00291                         tr(<a class="code" href="classElement.html#a8a280c85fef8e91be44c2c12274b0e8b" title="Returns the name of a given property.">Element::propertyName</a>(<a class="code" href="classElement.html#a480004eb27430763618c4a9986a51ada" title="Returns the Property with the specified index.">Element::getProperty</a>(i))), 
<a name="l00292"></a>00292                         QVariant(i));
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="comment">// redisplay the data</span>
<a name="l00296"></a>00296         <a class="code" href="classDataVisualizer.html#aa336a8fcd92c31c815c8de0897e8a43f" title="Selects another Element characteristic and rebuilds the graphics scene.">selectIndex</a>(selectedIndex);
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
</pre></div></div>
</div>
<hr size="1">
<table border="0" width="100%"><tr>
<td>
</td>
<td>
<address style="text-align: right;"><small>
Generated on Mon Nov 7 2011 Mon Nov 7 2011 11:38:13 for qSLDcalc 0.6 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.7.1 </small></address>
</td
</tr></table>
</body>
</html>
